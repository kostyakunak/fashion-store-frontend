# Рекомендации по созданию админ-страниц

## Общие принципы

При создании админ-страниц рекомендуется использовать компонент `GenericTableManager`, который предоставляет унифицированный интерфейс для работы с данными (просмотр, создание, редактирование, удаление).

## Типовые шаги при создании новой админ-страницы

1. **Анализ структуры данных**:
   - Изучите модель на сервере (Java-класс с аннотациями)
   - Обратите внимание на типы полей и связи с другими объектами

2. **Создание API-клиента**:
   - Создайте или используйте существующий API-клиент для работы с данными
   - Обязательные методы: getAll, create, update, delete

3. **Создание компонента с GenericTableManager**:
   - Определите список полей и их типы
   - Создайте рендереры для специальных полей (выпадающие списки, связанные данные)
   - Определите валидаторы для полей (или отключите валидацию "на лету")
   - Создайте обработчики для преобразования данных (onEdit и др.)
   - Добавьте загрузку зависимых данных (категории, роли и т.д.)

4. **Обновление маршрутизации**:
   - Добавьте маршрут в App.js
   - Добавьте ссылку в меню админ-панели

## Особенности работы с различными типами данных

### Автоинкремент ID
Для таблиц с автоинкрементом ID на сервере:
```javascript
create: (data) => {
    // ... подготовка данных ...
    delete dataToSend.id;
    return apiCreateMethod(dataToSend);
}
```

### Связанные данные (например, товар-категория)
Для правильной работы со связанными данными:
```javascript
// Загрузка связанных данных
useEffect(() => {
    const loadCategories = async () => {
        setCategories(await getCategories());
    };
    loadCategories();
}, []);

// Преобразование для редактирования
const handleOnEdit = (item) => {
    if (item.category && item.category.id) {
        return {
            ...item,
            categoryId: item.category.id
        };
    }
    return item;
};

// Рендерер для выпадающего списка
render: (item, onChange) => (
    <select
        value={item.categoryId || (item.category ? item.category.id : '')}
        onChange={(e) => onChange('categoryId', e.target.value)}
    >
        <option value="">Выберите категорию</option>
        {categories.map(category => (
            <option key={category.id} value={category.id}>
                {category.name}
            </option>
        ))}
    </select>
),

// Преобразование перед отправкой
create: (data) => {
    const dataToSend = {
        ...data,
        category: { id: parseInt(data.categoryId) }
    };
    delete dataToSend.categoryId;
    return apiCreateMethod(dataToSend);
}
```

## Избегание типичных ошибок

1. **Отображение ошибок**: 
   - Всегда обрабатывайте ошибки в try-catch блоках
   - Извлекайте сообщения об ошибках из ответа API

2. **Преобразование типов**:
   - При работе с числовыми полями в формах используйте `parseInt()` или `parseFloat()`
   - Будьте внимательны с типами при работе со связанными объектами

3. **Валидация**:
   - Для сложной валидации отключите проверку "на лету" и выполняйте её при отправке
   - Используйте проверку обязательных полей через `field.required`

4. **Сортировка данных**:
   - Всегда применяйте сортировку по ID после операций создания, обновления и удаления
   - Используйте сортировку при начальной загрузке данных
   - Пример: `data.sort((a, b) => a.id - b.id)`
   - Это обеспечит логичное отображение данных в таблице, особенно после CRUD-операций
   - Сортировка должна применяться во всех методах: getAll, create, update, delete

## Примеры

Для изучения рекомендуется посмотреть следующие компоненты:
- `AdminUsersGeneric.jsx` - пример работы с пользователями
- `AdminProductsGeneric.jsx` - пример работы с товарами и категориями
- `AdminAddresses.jsx` - пример работы с адресами

## Дополнительная документация

Для более подробной информации о работе с GenericTableManager смотрите:
- `/src/docs/GenericTableManagerGuide.md` - подробное руководство
- JSDoc-комментарии в `/src/components/generic/GenericTableManager.jsx` 